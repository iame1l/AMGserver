#include "stdafx.h"
//#include "../Client/stdafx.h"
#include "GameData.h"

GameData::GameData(void)
{

	m_iHuangZhuangCount = 0;
					
	///??????¡À???
	basepoint = 0;	
	///???¨º????????id
	ApplyThingID = 255;
	//?????????¡§??
	m_bShowTax = 0;

	memset(m_byThingNext,255,sizeof(m_byThingNext));

	InitData();
	LoadIni();
}

GameData::~GameData(void)
{

}


///?¨¨???¨´?????????¨®??????
void GameData::SetThingNext()
{
	//????????????
/*	T_Begin.byNext = m_byThingNext[THING_BEGIN];*/
	//?¡Á????????¡Á?????	
//	T_DongNt.byNext = m_byThingNext[THING_DONG_NT];
	//?¡Á????2????¡Á???????????¡Á?????	
	T_TwoSeziNt.byNext = m_byThingNext[THING_2SEZI_NT];
	//?¡Á????2????¡Á??¡§¡Á???????????????	
	T_TwoSeziNtAndGetPai.byNext = m_byThingNext[THING_2SEZI_NT_GP];
	//?¡Á?????¡Â??2????¡Á??¡§¡Á???????	
	T_TurnSeziNt.byNext = m_byThingNext[THING_TURN_2SEZI_NT];
	//??2????¡Á??????¡§????????????
//	T_TwoSeziDir.byNext = m_byThingNext[THING_2SEZI_DIR];
	//??2????¡Á??????¡§????????????????????
//	T_TwoSeziDirAndGetPai.byNext = m_byThingNext[THING_2SEZI_DIR_GP];
	//??2????¡Á??????¡§??????????	
	T_TwoSeziGetPai.byNext = m_byThingNext[THING_2SEZI_GP];
//?????¡ã????
	//????????	
//	T_SendPai.byNext = m_byThingNext[THING_SEND_PAI];
	//????????	
	T_TiaoPai.byNext = m_byThingNext[THING_TIAO_PAI];
	//??2????¡Á??¡§????????
	T_TwoSeziJing.byNext = m_byThingNext[THING_2SEZI_JING];
	//??1????¡Á??¡§????????
	T_OneSeziJin.byNext = m_byThingNext[THING_1SEZI_JIN];
	//???¨´?????????¡§????
	T_AllBuHua.byNext = m_byThingNext[THING_ALL_BUHUA];
	//???????????¡§????	
	T_OneBuHua.byNext = m_byThingNext[THING_ONE_BUHUA];
//??????¡Á¡Â????
	//¡Á????????????¡§??????
//	T_BeginOutPai.byNext = m_byThingNext[THING_BEGIN_OUT];
	//????????
//	T_OutPai.byNext = m_byThingNext[THING_OUT_PAI];
	//¡Á???????
	T_ZhuaPai.byNext = m_byThingNext[THING_ZHUA_PAI];
	//????????
	T_ChiPai.byNext = m_byThingNext[THING_CHI_PAI];
	//????????
	T_PengPai.byNext = m_byThingNext[THING_PENG_PAI];

	//????????
	T_GangPai.byNext = m_byThingNext[THING_GANG_PAI];
	//????????
	T_TingPai.byNext = m_byThingNext[THING_TING_PAI];
//?????¡ã?????¨®????
	//??????
//	T_HuPai.byNext = m_byThingNext[THING_HU_PAI];
	//????????	
//	T_CountFen.byNext = m_byThingNext[THING_COUNT_FEN];
	//?¨¢?????¨ª????
	T_EndHandle.byNext = m_byThingNext[THING_ENG_HANDLE];
	//???????¨¢?????¨ª????
	T_UnnormalEndHandle.byNext = m_byThingNext[THING_ENG_UN_NORMAL];
}

///?¨¨?????????????¨®??????
void GameData::SetThingNext(BYTE id)
{
//	switch(id)
//	{
////?????¡ã????
//	case THING_BEGIN:			//????????????
//		T_Begin.byNext = m_byThingNext[id];
//		break;
//	case THING_DONG_NT:			//?¡Á????????¡Á?????	
//		T_DongNt.byNext = m_byThingNext[id];
//		break;
//	case THING_2SEZI_NT:		//?¡Á????2????¡Á???????????¡Á?????	
//		T_TwoSeziNt.byNext = m_byThingNext[id];
//		break;
//	case THING_2SEZI_NT_GP:		//?¡Á????2????¡Á??¡§¡Á???????????????	
//		T_TwoSeziNtAndGetPai.byNext = m_byThingNext[id];
//		break;
//	case THING_TURN_2SEZI_NT:	//?¡Á?????¡Â??2????¡Á??¡§¡Á???????	
//		T_TurnSeziNt.byNext = m_byThingNext[id];
//		break;
//	case THING_2SEZI_DIR:		//??2????¡Á??????¡§????????????
//		T_TwoSeziDir.byNext = m_byThingNext[id];
//		break;
//	case THING_2SEZI_DIR_GP:	//??2????¡Á??????¡§????????????????????
//		T_TwoSeziDirAndGetPai.byNext = m_byThingNext[id];
//		break;
//	case THING_2SEZI_GP:		//??2????¡Á??????¡§??????????	
//		T_TwoSeziGetPai.byNext = m_byThingNext[id];
//		break;
////?????¡ã????
//	case THING_SEND_PAI:		//????????	
//		T_SendPai.byNext = m_byThingNext[id];
//		break;
//	case THING_TIAO_PAI:		//????????	
//		T_TiaoPai.byNext = m_byThingNext[id];
//		break;
//	case THING_2SEZI_JING:		//??2????¡Á??¡§????????
//		T_TwoSeziJing.byNext = m_byThingNext[id];
//		break;
//	case THING_1SEZI_JIN:		//??1????¡Á??¡§????????
//		T_OneSeziJin.byNext = m_byThingNext[id];
//		break;
//	case THING_ALL_BUHUA:		//???¨´?????????¡§????
//		T_AllBuHua.byNext = m_byThingNext[id];
//		break;
//	case THING_ONE_BUHUA:		//???????????¡§????	
//		T_OneBuHua.byNext = m_byThingNext[id];
//		break;
////??????¡Á¡Â????
//	case THING_BEGIN_OUT:		//¡Á????????????¡§??????
//		T_BeginOutPai.byNext = m_byThingNext[id];
//		break;
//	case THING_OUT_PAI:			//????????
//		T_OutPai.byNext =		m_byThingNext[id];
//		break;
//	case THING_ZHUA_PAI:		//¡Á???????
//		T_ZhuaPai.byNext = m_byThingNext[id];
//		break;
//	case THING_CPG_NOTIFY:		//???????¡§??????????
//		break;
//	case THING_CHI_PAI:			//????????
//		T_ChiPai.byNext = m_byThingNext[id];
//		break;
//	case THING_PENG_PAI:		//????????
//		T_PengPai.byNext = m_byThingNext[id];
//		break;

//		break;
//	case THING_SAO_HU:			//?¡§??????
//		T_SaoHu.byNext = m_byThingNext[id];
//		break;
//	case THING_GANG_PAI:		//????????
//		T_GangPai.byNext = m_byThingNext[id];
//		break;
//	case THING_TING_PAI:		//????????
//		T_TingPai.byNext = m_byThingNext[id];
//		break;
////??????¡Á¡Â????
////?????¡ã?????¨®????
//	case THING_HU_PAI:			//??????
//		T_HuPai.byNext = m_byThingNext[id];
//		break;
//	case THING_COUNT_FEN:		//????????	
//		T_CountFen.byNext = m_byThingNext[id];
//		break;
//	case THING_ENG_HANDLE:		//?¨¢?????¨ª????
//		T_EndHandle.byNext = m_byThingNext[id];
//		break;
//	case THING_ENG_UN_NORMAL:	//???????¨¢?????¨ª????
//		T_UnnormalEndHandle.byNext = m_byThingNext[id];
//		break;
//	}
	 
}

///??????????
void GameData::InitData()
{
	memset(m_byThingRecord,255,sizeof(m_byThingRecord));
	memset(m_bGangState,0,sizeof(m_bGangState));//????????¡Á??????????????????¨®??
	memset(m_bUserPeiPai, false, sizeof(m_bUserPeiPai));
	memset(byAllPeiPai, 255, sizeof(byAllPeiPai));

	m_bPeiPai = false;
	m_bPeiPai = false;
	m_byNtStation	= 255;	//¡Á???????
	ApplyThingID	= 255;	///???¨º????????	DWJ
	m_byThingDoing	= 255;	///???????¨²????????
	m_byWatingThing	= 255;	//??????????????????
	m_iRemaindTime = 0;
	///??????????
	m_byNextAction = ACTION_NO;

	///??????????,???¡À????
	temp_ChiPai.Clear();
	///??????????,???¡À????
	temp_PengPai.Clear();
	///??????????,???¡À????
	temp_GangPai.Clear();
	///????????????
	T_Begin.Clear();
	///??????¡Á?????
	T_DongNt.Clear();
	///??2????¡Á???????????¡Á?????
	T_TwoSeziNt.Clear();
	///??2????¡Á????¡§¡Á???????????????????
	T_TwoSeziNtAndGetPai.Clear();
	///???¡Â??2????¡Á????¡§¡Á???
	T_TurnSeziNt.Clear();
	///??2????¡Á????¡§????????????
	T_TwoSeziDir.Clear();
	///??2????¡Á????¡§?????????¡§?????????????????¡§¡Á???????????
	T_TwoSeziDirAndGetPai.Clear();
	///??2????¡Á????¡§????????????
	T_TwoSeziGetPai.Clear();
	///????????
	T_SendPai.Clear();
	///????????
	T_TiaoPai.Clear();
	///????¡Á?2????¡Á??¡§????????
	T_TwoSeziJing.Clear();
	///????¡Á?1????¡Á??¡§????????
	T_OneSeziJin.Clear();
	///?¨´?????????¡§????
	T_AllBuHua.Clear();
	///???????????¡§????
	T_OneBuHua.Clear();
	///?????????¡§??????
	T_BeginOutPai.Clear();
	///????????
	T_OutPai.Clear();
	///¡Á?????????
	T_ZhuaPai.Clear();
	/////???????????¡§????????????
	T_CPGNotify[PLAY_COUNT].Clear();
	///??????????
	T_ChiPai.Clear();
	///??????????
	T_PengPai.Clear();
	///??????????
	T_GangPai.Clear();
	///??????????
	T_TingPai.Clear();
	///??????????
	T_HuPai.Clear();
	///????????
	T_CountFen.Clear();
	///?????¨¢?????¨ª????
	T_EndHandle.Clear();
	///???????¨¢?????¨ª????
	T_UnnormalEndHandle.Clear();

	SetThingNext();

}
/*--------------------------------------------------------------------------*/
///????????????
void GameData::LoadIni()
{
	m_mjRule.byAllMjCount   = 112;			//?¨¦???????? 

	m_mjRule.bHaveWan		= 1;			//????????
	m_mjRule.bHaveTiao		= 1;			//????????
	m_mjRule.bHaveBing		= 1;			//??????¡À¨²
	m_mjRule.bHaveHongZhong	= 1;			//??????????
	m_mjRule.bHaveFaCai		= 0;			//??????????
	m_mjRule.bHaveBaiBan	= 0;			//??????¡ã¡Á¡ã?
	m_mjRule.bHaveFengPai	= 0;			//???????????¡Â¡À¡À
	m_mjRule.bHaveFlower	= 0;			//???????¡§??

	m_mjRule.byHandCardNum	= 13;			//????????
	m_mjRule.byGamePassNum	= 0;			//?¡Â??????
	m_mjRule.byGamePassType	= 0;			//?¡Â???????¨¤??
	m_mjRule.byNextNtType	= 2;			//????¡Á????????¡§?¨¤??
	m_mjRule.bHaveJing		= 1;			//????????
	m_mjRule.byMenPaiNum[0]	= 28;			//?¡Â????????
	m_mjRule.byMenPaiNum[1]	= 28;			//?¡Â????????
	m_mjRule.byMenPaiNum[2]	= 28;			//?¡Â????????
	m_mjRule.byMenPaiNum[3]	= 28;			//?¡Â????????

	m_mjAction.bChi				= 0;		//??
	m_mjAction.bChiFeng			= 0;		//??????
	m_mjAction.bChiJian			= 0;		//??????¡ã¡Á
	m_mjAction.bPeng			= 1;		//??
	m_mjAction.bKan				= 0;		//??
	m_mjAction.bSaoHu			= 0;		//?¡§??
	m_mjAction.bGang			= 1;		//??
	m_mjAction.bBuGang			= 1;		//????
	m_mjAction.bTing			= 1;		//??
	m_mjAction.bQiangChi		= 0;		//????(???¨®????)

	
#pragma warning(push)
#pragma warning(disable:4800)
	CString s = CINIFile::GetAppPath ();/////¡À???????
	CINIFile pz(s + SKIN_FOLDER  + _T("_s.ini"));
	CString key = TEXT("game");// ?¨¦??????????

	m_mjRule.byAutoOutTime	= pz.GetKeyVal(key,TEXT("byAutoOutTime"),1);		//¡Á????????¡À??	
	m_mjRule.byOutTime		= pz.GetKeyVal(key,TEXT("byOutTime"),15);			//?????¡À??		
	m_mjRule.byBlockTime	= pz.GetKeyVal(key,TEXT("byBlockTime"),15);			//?????????¡À??	
	m_mjRule.byBeginTime	= pz.GetKeyVal(key,TEXT("byBeginTime"),15);			//?????????¡À??	
	m_mjRule.bAutoBegin		= pz.GetKeyVal(key,TEXT("bAutoBegin"),0);			//?¡À??????????¡Á???????
	m_mjRule.byZhongTime	= pz.GetKeyVal(key,TEXT("byZhongTime"),5);			//?????????¡À??
	m_mjRule.byTuoGuanTime  = pz.GetKeyVal(key,TEXT("byTuoGuanTime"),60);		//?????¡À??
	m_mjRule.bNetCutTuoGuan	= pz.GetKeyVal(key,TEXT("bNetCutTuoGuan"),1);		//????????????
	m_mjRule.bForceTuoGuan	= pz.GetKeyVal(key,TEXT("bForceTuoGuan"),1);		//????????????
	m_mjRule.byGamePassNum	= pz.GetKeyVal(key,TEXT("GamePassNum"),0);			//?¡Â??????
	m_mjRule.byZamaNum		= pz.GetKeyVal(key,TEXT("ZamaNum"), 4);				//?¨²?¨ª??
	m_mjRule.bPeiPai		= pz.GetKeyVal(key,TEXT("PeiPai"), 0);				//????????

	if (m_mjRule.bPeiPai)
	{
		CString sText;
		for(int i=0; i<PLAY_COUNT; i++)
		{
			sText.Format("PeiPai%d",i);
			m_bUserPeiPai[i] = pz.GetKeyVal(key, sText, 0);
//			DebugPrintf("m_bUserPeiPai[%d] = %d", i, m_bUserPeiPai[i]);
		}

		BYTE card = 1;
		int index = 0;
		int num = 0;

		for(int i=0; i<PLAY_COUNT; i++)
		{
			num = (i==0 ? 14:13);

			for (int j=0; j<num; j++)
			{
				sText.Format("Card%d",index);
				if (card%10 == 0)
				{
					card += 1;
				}

				byAllPeiPai[index] = byPeiPai[i][j] = (m_bUserPeiPai[i] ? pz.GetKeyVal(key, sText,card) : 255);
				//DebugPrintf("index=%d, PeiPai[%d][%d]=%d", index, i, j, byPeiPai[i][j]);

				card++;
				index++;
			}
		}
	}
#pragma warning(pop)
}
/*--------------------------------------------------------------------------*/